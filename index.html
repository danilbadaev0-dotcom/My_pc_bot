<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>PC Remote</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#0e0f13;color:#eaeaea}
    .wrap{padding:14px;max-width:720px;margin:0 auto}
    h1{font-size:18px;margin:8px 0 12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
    .btn{flex:1 1 auto;padding:12px;border-radius:12px;background:#1f232b;border:1px solid #2d3440;text-align:center;cursor:pointer;user-select:none}
    .btn:active{transform:scale(.98)}
    .input{width:100%;padding:12px;border-radius:12px;border:1px solid #2d3440;background:#11151b;color:#eaeaea}
    .kbd{display:flex;gap:6px;flex-wrap:wrap;margin:6px 0}
    .sw{display:flex;align-items:center;gap:8px;margin:6px 0}
    .small{font-size:12px;opacity:.8}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  </style>
</head>
<body>
<div class="wrap">
  <h1>PC Remote ‚Äî <span id="title">@frogovbot</span></h1>

  <div class="row">
    <div class="btn" id="mute">üîá Mute</div>
    <div class="btn" id="ping">Ping</div>
  </div>

  <div class="sw">
    <input id="focusToggle" type="checkbox" checked />
    <label for="focusToggle">–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—Å–µ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç–∞</label>
  </div>
  <div class="sw">
    <input id="liveToggle" type="checkbox" checked />
    <label for="liveToggle">–†–µ–∂–∏–º –∂–∏–≤–æ–≥–æ –Ω–∞–±–æ—Ä–∞</label>
  </div>

  <input id="textInput" class="input" placeholder="–ü–µ—á–∞—Ç–∞–π –∑–¥–µ—Å—å ‚Äî —Ç–µ–∫—Å—Ç —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥—ë—Ç –Ω–∞ –ü–ö" autocomplete="on" />

  <div class="row">
    <div class="btn" id="sendToClipboard">–í –±—É—Ñ–µ—Ä –ü–ö</div>
    <div class="btn" id="paste">–í—Å—Ç–∞–≤–∏—Ç—å (Ctrl+V)</div>
    <div class="btn" id="getClipboard">–°—á–∏—Ç–∞—Ç—å –±—É—Ñ–µ—Ä</div>
  </div>

  <div class="kbd">
    <label><input type="checkbox" id="win"> WIN</label>
    <label><input type="checkbox" id="ctrl"> CTRL</label>
    <label><input type="checkbox" id="alt"> ALT</label>
    <label><input type="checkbox" id="shift"> SHIFT</label>
  </div>
  <div class="row">
    <input id="keyField" class="input" placeholder="–ö–ª–∞–≤–∏—à–∞: A / F5 / Enter / Tab / Esc ..." />
    <div class="btn" id="sendKey" style="flex:0 0 120px">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</div>
  </div>

  <div class="grid">
    <div class="btn" data-k="esc">Esc</div>
    <div class="btn" data-k="tab">Tab</div>
    <div class="btn" data-k="enter">Enter</div>
    <div class="btn" data-k="left">‚óÄ</div>
    <div class="btn" data-k="down">‚ñº</div>
    <div class="btn" data-k="right">‚ñ∂</div>
    <div class="btn" data-k="up">‚ñ≤</div>
    <div class="btn" data-k="backspace">Backspace</div>
  </div>

  <p class="small">F1‚Ä¶F12 –ø–∏—à–∏ –∫–∞–∫ F1, F2, ... ‚Ä¢ –í –∂–∏–≤–æ–º —Ä–µ–∂–∏–º–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ —à–ª—ë—Ç Backspace –Ω–∞ –ü–ö.</p>
</div>

<script>
const tg = window.Telegram.WebApp; tg.expand();
const el = id => document.getElementById(id);
const send = (type, payload={}) => tg.sendData(JSON.stringify({type, payload}));

el('title').textContent = tg.initDataUnsafe?.user?.username ? '@'+tg.initDataUnsafe.user.username : el('title').textContent;

const focusToggle = el('focusToggle'), textInput = el('textInput'), liveToggle = el('liveToggle');
const ensureFocus = ()=>{ if(focusToggle.checked) setTimeout(()=>textInput.focus(), 50); };
ensureFocus(); document.addEventListener('visibilitychange', ensureFocus); focusToggle.addEventListener('change', ensureFocus);

// –∂–∏–≤–æ–π –Ω–∞–±–æ—Ä: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–µ–ª—å—Ç—É (–¥–æ–±–∞–≤–∏–ª–∏ ‚Äî type_text, —É–¥–∞–ª–∏–ª–∏ ‚Äî backspace x N)
let lastValue = "";
textInput.addEventListener('input', ()=>{
  if(!liveToggle.checked) return;
  const cur = textInput.value;
  // –Ω–∞–π–¥—ë–º –æ–±—â–∏–π –ø—Ä–µ—Ñ–∏–∫—Å
  let i=0; while(i<lastValue.length && i<cur.length && lastValue[i]===cur[i]) i++;
  if(cur.length > lastValue.length){ // –¥–æ–±–∞–≤–∏–ª–∏
    const add = cur.slice(i);
    if(add) send('type_text', {text: add});
  }else if(cur.length < lastValue.length){ // —É–¥–∞–ª–∏–ª–∏
    const n = lastValue.length - cur.length;
    if(n>0) send('send_keys', {key:'backspace', repeat:n});
  }
  lastValue = cur;
});

// Enter = –≤—Å—Ç–∞–≤–∫–∞
textInput.addEventListener('keydown', e=>{
  if(e.key==='Enter'){ send('set_clipboard',{text:textInput.value}); send('paste'); e.preventDefault(); }
});

// –±—É—Ñ–µ—Ä
el('sendToClipboard').onclick = ()=> send('set_clipboard',{text:textInput.value});
el('paste').onclick          = ()=> send('paste');
el('getClipboard').onclick   = ()=> send('get_clipboard');

// –∫–ª–∞–≤–∏—à–∏
const mod = id => el(id).checked;
function sendKey(k, repeat=1){ send('send_keys',{key:k, win:mod('win'), ctrl:mod('ctrl'), alt:mod('alt'), shift:mod('shift'), repeat}); ensureFocus(); }
el('sendKey').onclick = ()=>{ const raw = el('keyField').value.trim().toLowerCase(); if(raw) sendKey(raw); };
document.querySelectorAll('.grid .btn[data-k]').forEach(b=> b.onclick = ()=> sendKey(b.getAttribute('data-k')) );

// mute + ping
el('mute').onclick = ()=> send('toggle_mute');
el('ping').onclick = ()=> send('ping');
</script>
</body>
</html>
